------- Consultation -------



select * from CLUBS;
//////////////
select * from EQUIPES;
//////////////
select * from JOUEURS;
//////////////

select R.DATE_DE_RENCONTRE,E1.NOM_EQUIPE as EQUIPE_ACCUEILLANTE,R.SCORE_EQUIPE_ACCUEILLANTE,E2.NOM_EQUIPE as EQUIPE_RECUS,R.SCORE_EQUIPE_RECUE
    from RENCONTRES R, EQUIPES E1, EQUIPES E2
    where E1.NUMERO_EQUIPE  = R.NUMERO_EQUIPE_ACCUEILLANTE and E2.NUMERO_EQUIPE  = R.NUMERO_EQUIPE_RECUE; 

//////////////

select R.DATE_DE_RENCONTRE, J.NOM_JOUEUR as NOM, J.PRENOM_JOUEUR as PRENOM
    from JOUEURS J, PARTICIPER P,RENCONTRES R 
    where R.NUMERO_DE_RENCONTRE = P.NUMERO_DE_RENCONTRE and P.NUMERO_DE_LICENCE = J.NUMERO_DE_LICENCE;
//////////////
create view T1 (NUMERO_DE_RENCONTRE,DATE_DE_RENCONTRE,EQUIPE_ACCUEILLANTE,NOM,PRENOM,BUTS,FAUTES,SCORE)
as select  R.NUMERO_DE_RENCONTRE,
        R.DATE_DE_RENCONTRE,
        E.NOM_EQUIPE,
        J.NOM_JOUEUR,
        J.PRENOM_JOUEUR,
        P.NOMBRE_POINTS_MARQUES,
        P.NOMBRE_FAUTES_COMMISES,
        R.SCORE_EQUIPE_ACCUEILLANTE
        
        from RENCONTRES R, EQUIPES E, PARTICIPER P, JOUEURS J
        where R.NUMERO_EQUIPE_ACCUEILLANTE = E.NUMERO_EQUIPE
            and R.NUMERO_DE_RENCONTRE = P.NUMERO_DE_RENCONTRE
            and P.NUMERO_DE_LICENCE = J.NUMERO_DE_LICENCE
        ;
        

create view T2 (NUMERO_DE_RENCONTRE,DATE_DE_RENCONTRE,EQUIPE_RECUS,NOM,PRENOM,BUTS,FAUTES,SCORE)
as select  R.NUMERO_DE_RENCONTRE,
        R.DATE_DE_RENCONTRE,
        E.NOM_EQUIPE,
        J.NOM_JOUEUR,
        J.PRENOM_JOUEUR,
        P.NOMBRE_POINTS_MARQUES,
        P.NOMBRE_FAUTES_COMMISES,
        R.SCORE_EQUIPE_RECUE
        
        from RENCONTRES R, EQUIPES E, PARTICIPER P, JOUEURS J
        where R.NUMERO_EQUIPE_RECUE = E.NUMERO_EQUIPE
            and R.NUMERO_DE_RENCONTRE = P.NUMERO_DE_RENCONTRE
            and P.NUMERO_DE_LICENCE = J.NUMERO_DE_LICENCE
        ;

select * from T1 , T2 where T1.NUMERO_DE_RENCONTRE = T2.NUMERO_DE_RENCONTRE order by T1.NUMERO_DE_RENCONTRE;
//////////////



% nbre matches gagnes par equipe
select E.NUMERO_EQUIPE , E.NOM_EQUIPE, count(*) as MATCHS_GAGNE 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE > R.SCORE_EQUIPE_RECUE) 
        or (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_RECUE and R.SCORE_EQUIPE_RECUE > R.SCORE_EQUIPE_ACCUEILLANTE)
        group by 1,2; 


% nbre matches gagnes par club
select C.NUMERO_CLUB , C.NOM_CLUB, count(*) as MATCHS_GAGNE 
    from CLUBS C, EQUIPES E, RENCONTRES R 
    where E.NUMERO_CLUB = C.NUMERO_CLUB
        and ( (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE > R.SCORE_EQUIPE_RECUE) 
        or (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_RECUE and R.SCORE_EQUIPE_RECUE > R.SCORE_EQUIPE_ACCUEILLANTE))
        group by 1; 


% nbre matches perdues
select E.NUMERO_EQUIPE , E.NOM_EQUIPE, count(*) as MATCHS_PERDUES 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE < R.SCORE_EQUIPE_RECUE) 
        or (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_RECUE and R.SCORE_EQUIPE_RECUE < R.SCORE_EQUIPE_ACCUEILLANTE)
        group by 1;


% nbre matches perdues par club
select C.NUMERO_CLUB , C.NOM_CLUB, count(*) as MATCHS_PERDUES 
    from CLUBS C, EQUIPES E, RENCONTRES R 
    where E.NUMERO_CLUB = C.NUMERO_CLUB
        and ( (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE < R.SCORE_EQUIPE_RECUE) 
        or (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_RECUE and R.SCORE_EQUIPE_RECUE < R.SCORE_EQUIPE_ACCUEILLANTE) )
        group by 1; 


%nbre de matches nuls
select E.NUMERO_EQUIPE , E.NOM_EQUIPE, count(*) as MATCHS_NULS 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE = R.SCORE_EQUIPE_RECUE)
    group by 1;


%nbre de matches nuls par club
select C.NUMERO_CLUB , C.NOM_CLUB, count(*) as MATCHS_NULS 
    from CLUBS C, EQUIPES E, RENCONTRES R 
    where E.NUMERO_CLUB = C.NUMERO_CLUB
        and ( (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE = R.SCORE_EQUIPE_RECUE) )
        group by 1; 


-------- Statistques --------
////////
%moyenne des points marqués PAR RENCONTRE à une date donnée
select DATE_DE_RENCONTRE, NUMERO_DE_RENCONTRE, (R.SCORE_EQUIPE_ACCUEILLANTE + R.SCORE_EQUIPE_RECUE) as RR, AVG( R.SCORE_EQUIPE_ACCUEILLANTE + R.SCORE_EQUIPE_RECUE ) as MOYENNE_POINTS
    from RENCONTRES R
    group by 1
    ;

/////// A REVOIR
%moyenne des points marqués depuis le début de la saison
select S.DATE_DE_DEBUT , AVG( (R.SCORE_EQUIPE_ACCUEILLANTE + R.SCORE_EQUIPE_RECUE)/2 )
    from RENCONTRES R, PARTICIPER P, JOUEURS J, SAISONS_JOUEES SJ, SAISONS S
    where R.NUMERO_DE_RENCONTRE = P.NUMERO_DE_RENCONTRE
        and P.NUMERO_DE_LICENCE = J.NUMERO_DE_LICENCE
        and J.NUMERO_DE_LICENCE = SJ.NUMERO_DE_LICENCE
        and SJ.NUMERO_SAISON = S.NUMERO_SAISON
    group by 1;

////////

select R.DATE_DE_RENCONTRE,J.NUMERO_DE_LICENCE,J.NOM_JOUEUR,J.PRENOM_JOUEUR,P.NOMBRE_POINTS_MARQUES,P.NOMBRE_FAUTES_COMMISES
    from RENCONTRES R, PARTICIPER P, JOUEURS J where R.NUMERO_DE_RENCONTRE = P.NUMERO_DE_RENCONTRE and P.NUMERO_DE_LICENCE = J.NUMERO_DE_LICENCE
    order by 5 DESC,6 ASC;

////////
% nbre matches gagnes pour une equipe
create or replace view MG (CATEGORIE,NUMERO_EQUIPE,NOM_EQUIPE,W)
as select E.CATEGORIE,E.NUMERO_EQUIPE, E.NOM_EQUIPE, count(*) as MATCHS_GAGNE 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE > R.SCORE_EQUIPE_RECUE) 
        or (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_RECUE and R.SCORE_EQUIPE_RECUE > R.SCORE_EQUIPE_ACCUEILLANTE)
        group by 1,2; 

% nbre matches perdues pour une equipe
create or replace view MP (CATEGORIE,NUMERO_EQUIPE,NOM_EQUIPE,L)
as select E.CATEGORIE,E.NUMERO_EQUIPE ,E.NOM_EQUIPE, count(*) as MATCHS_PERDU 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE < R.SCORE_EQUIPE_RECUE) 
        or (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_RECUE and R.SCORE_EQUIPE_RECUE < R.SCORE_EQUIPE_ACCUEILLANTE)
        group by 1,2;

%nbre de matches nuls
create or replace view MN (CATEGORIE,NUMERO_EQUIPE,NOM_EQUIPE,N)
as select E.CATEGORIE,E.NUMERO_EQUIPE ,E.NOM_EQUIPE, count(*) as MATCHS_NULL 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE = R.SCORE_EQUIPE_RECUE)
    group by 1,2;
    
select MG.CATEGORIE,MG.NUMERO_EQUIPE,MG.NOM_EQUIPE,MG.W,MN.N,MP.L
    from MG,MN,MP where MG.NUMERO_EQUIPE = MN.NUMERO_EQUIPE
    and MN.NUMERO_EQUIPE = MP.NUMERO_EQUIPE;

select E.CATEGORIE,E.NUMERO_EQUIPE ,E.NOM_EQUIPE, count(*) as MATCHS_NULL 
    from EQUIPES E, RENCONTRES R 
    where (E.NUMERO_EQUIPE = R.NUMERO_EQUIPE_ACCUEILLANTE and R.SCORE_EQUIPE_ACCUEILLANTE = R.SCORE_EQUIPE_RECUE)
    group by 1,2;


select * from MN left outer join RENCONTRES using(MN.NUMERO_EQUIPE);
